<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Dashpilot</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
</head>

<body spellCheck="false">
  <main class="container mt-5">
    <div x-data="loadData()" x-init="loadData().get">

      <template x-if="data">

          <div>
            
            hello
            <h1 x-text="data.metadata.title"></h1>
        
        <p x-text="data.content"></p>
  
        </div>
            
      </template>
      </div>
    <script>
      function loadData() {
        return {
          // other default properties
          isLoading: false,
          data: null,
          show: null,
          get() {
            this.isLoading = true;
            var opts = {
              path: "blog/hello.md",
            }
            fetch('/api/github/get-md', {
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(opts),
                method: 'post',
              })
              .then(response => response.json())
              .then(res => {
                console.log(res)
                this.data = res.msg;
              })
              .catch(error => {
                console.error('Error:', error)
              })
          
          },
          save() {
            console.log(document.querySelector('[x-data]').__x.getUnobservedData().data);
            var data = document.querySelector('[x-data]').__x.getUnobservedData().data;
            var opts = {
              path: "public/data.json",
              type: "json",
              content: data
            }
            fetch('/api/github/set-data', {
                headers: {
                  'Authorization': window.token,
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(opts),
                method: 'post',
              })
              .then(response => response.json())
              .then(res => {
                console.log('Success:', res)
              })
              .catch(error => {
                console.error('Error:', error)
              })


          }
        }
      }
    </script>

  </main>

  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.1/dist/alpine.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/gh/maxeckel/alpine-editor@0.3.1/dist/alpine-editor.min.js"></script>
  <script type="text/javascript" src="https://sdk.userbase.com/2/userbase.js"></script>
  <script>
    config = {};
    config.appId = 'ac1c771e-cae2-4fae-b559-312cd95b5d76';
    userbase
      .init({
        appId: config.appId,
      })
      .then(function(session) {


        if (typeof session.user !== 'undefined') {
          console.log('logged in')
          sessionStorage.setItem('username', session.user.username);
          window.token = session.user.authToken;
          
            
          
          
        } else {

          sessionStorage.removeItem('username');
        }

      });
  </script>
</body>

</html>
